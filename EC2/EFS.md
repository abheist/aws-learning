Elastic File System
- Managed NFS (network file system) that can be mounted on many EC2
- EFS works with EC2 instances in multi-AZ
- Highly available, scalable, expensive (3 x `gp2`), pay per use.![Screenshot 2023-06-06 at 9.54.54 PM](../images%201/Screenshot%202023-06-06%20at%209.54.54%20PM.png)
- Use cases
	- Content management
	- Web serving
	- Data sharing
	- Wordpress
- Uses NFSv4.1 protocol
- Uses security group to control access to EFS
- Compatible with Linux based AMI (not windows)
- Encryption at rest using KMS
- POSIX file system (~Linux) that has a standard file API
- File system scales automatically, pay-per-use, no capacity planning
- Performance
	- EFS Scale
		- 1000s of concurrent NFS clients, 10 GB+ /s throughput
		- Grow to petabyte-scale network file system, automatically
	- Performance mode (set at EFS creation time)
		- General Purpose (default) - latency-sensitive use cases (web server, CMS, etc...)
		- MAX I/O - higher latency, throughput, highly parallel (big data, media processing)
	- Throughput Mode
		- Bursting - 1TB = 50 MiB/s + burst of up to 100 MiB/s
		- Provisioned - set your throughput regardless of storage size, ex: 1 GiB/s for 1 TB storage
		- Elastic - automatically scales throughput up or down based on our workloads
			- Up to 3 GiB/s for reads and 1 GiB/s for writes
			- Used for unpredictable workloads
-  Storage classes
	- Storage tiers (lifecycle management feature - move file after N days)
		- Standard: for frequent accessed files
		- Infrequent access (EFS-IA): cost to retrieve files, lower price to store. Enable EFS-IA with a lifecycle policy
	- Availability and Durability
		- Standard: Multi-AZ, great for prod
		- One Zone: One AZ, great for dev, backup enabled by default, compatible with IA (EFS One Zone-IA)
	- Over 90% in cost-savings
- Hands-on
	- Search for EFS in AWS search bar and go to EFS home page
	- There you'll see `Create filesystem` button, click on that
	- It'll open up a form, the form will be short, but to have more choices, click on `Customize` button at the bottom of the pop-up, the form page will open:
		- File System settings
			- Name
			- Availability and Durability
				- Regional/standard
				- One Zone
			- Automatic backups checkbox, enable it for now
			- Lifecycle management
				- Transition to IA (Infrequent Access), select 30 days for now
				- Transition out of IA, select on first access for now
			- Performance mode
				- General purpose, select for now
				- Max I/O
			- Throughput mode
				- Bursting, select for now
				- Provisioned
			- Encryption, leave it as enabled for now
			- Click next
		- Network access settings
			- VPC
			- Mount targets
				- Select availability zones here with subnet IDs and security groups
			- Click next
		- File System Policy
			- Don't touch anything for now, click next
		- Review and click Create button
		- Once created, it'll be visible on EFS home page, select the file system and open it's page
		- You can find general information on its page.
	- To add EFS to EC2 instance
		- Create few instances
		- in the instances form when creating them
		- You need to add a subnet to add any EFS to EC2
		- In network settings, click on edit
		- Select subnet, for the AZ
		- Once the subnet is added, you can go down to Storage section and there you'll see the File Systems sections
		- There you can select EFS
		- click on `Add shared file system` button, it'll show a dropdown with all the created EFS
		- Select the EFS you want to add
		- Enter the mount point, `/mnt/efs/fs1`
		- Check the required checkboxes
			- Automatically create and attach security groups
			- Automatically mount shared file system by attaching required user data script
		- Click on `lunch`
		- Instance is launched
		- Now you can go to EFS and check that new security groups will be added which were added by EC2 automatically
		- To check the connectivity
			- Select an EC2 instances we created, click connect
			- goto `/mnt/efs/fs1` and create a new file and some data
			- and you can login from another EC2 instance with the same EFS and can checkout that file again.

### [EBS](EBS.md) vs [EFS](.md)
- EBS
	- EBS volumes
		- one instance (except multi-attach `io1/io2`)
		- are locked at the AZ level
		- `gp2`: IO increases if the disk size increases
		- `io1`: can increase IO independently
	- To migrate an EBS volume across AZ
		- Take a snapshot
		- Restore the snapshot to another AZ
		- EBS backups use IO and you shouldn't run them while your application is handling a lot of traffic
	- Root EBS volumes of instances get terminated by default if the EC2 instance gets terminated. (you can disable that)![Screenshot 2023-06-06 at 10.41.19 PM](../images%201/Screenshot%202023-06-06%20at%2010.41.19%20PM.png)
- EFS
	- Mounting 100s of instance across AZ
	- EFS share website files (WordPress)
	- Only for Linux Instances (POSIX)
	- EFS has a higher price point than EBS
	- can leverage EFS-IA for cost savings
	- Remember: EFS vs EBS vs Instance Store![Screenshot 2023-06-06 at 10.43.03 PM](../images%201/Screenshot%202023-06-06%20at%2010.43.03%20PM.png)
	- 